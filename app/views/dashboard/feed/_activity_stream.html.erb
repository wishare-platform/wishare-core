<!-- Activity Stream -->
<div class="space-y-4"
     data-controller="activity-feed"
     data-activity-feed-user-id-value="<%= @user.id %>"
     data-activity-feed-feed-type-value="for_you"
     data-activity-feed-locale-value="<%= I18n.locale %>"
     data-activity-feed-no-activities-value="<%= t('dashboard.activity_counter.no_activities') %>"
     data-activity-feed-one-activity-value="<%= t('dashboard.activity_counter.one_activity') %>"
     data-activity-feed-multiple-activities-value="<%= t('dashboard.activity_counter.multiple_activities', count: '__COUNT__') %>"
     data-activity-feed-new-activity-notification-value="<%= t('dashboard.feed.notifications.new_activity_from', name: '__NAME__') %>"
     data-activity-feed-friend-notification-prefix-value="<%= t('dashboard.feed.notifications.friend_activity_prefix', name: '__NAME__') %>">

  <!-- Loading State -->
  <div data-activity-feed-target="loadingState" class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl shadow-sm border border-rose-100 dark:border-gray-700 p-8 text-center">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-rose-500 mx-auto mb-4"></div>
    <p class="text-gray-600 dark:text-gray-400"><%= t('dashboard.feed.activity_stream.loading_feed') %></p>
  </div>

  <!-- Activity Feed Container -->
  <div data-activity-feed-target="container" class="space-y-4 hidden">
  </div>

  <!-- Load More Button -->
  <div class="text-center pt-4" style="display: none;"
       data-activity-feed-target="loadMoreButton">
    <button type="button"
            class="px-6 py-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors font-medium"
            data-action="click->activity-feed#loadMore">
      <%= t('dashboard.feed.activity_stream.load_more') %>
    </button>
  </div>

  <!-- Empty State (will be shown when no activities) -->
  <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-xl shadow-sm border border-rose-100 dark:border-gray-700 p-8 text-center hidden"
       data-activity-feed-target="emptyState">
    <svg class="w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
    </svg>
    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-2">
      <%= t('dashboard.feed.activity_stream.no_activities') %>
    </h3>
    <p class="text-gray-600 dark:text-gray-400 mb-6">
      <%= t('dashboard.feed.activity_stream.get_started') %>
    </p>
    <div class="flex flex-col sm:flex-row gap-3 justify-center">
      <%= link_to t('dashboard.feed.activity_stream.create_wishlist'), new_wishlist_path,
          class: "inline-flex items-center gap-2 px-4 py-2 bg-rose-500 hover:bg-rose-600 text-white font-medium rounded-lg transition-colors" %>
      <%= link_to t('dashboard.feed.activity_stream.invite_friends'), new_invitation_path,
          class: "inline-flex items-center gap-2 px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-medium rounded-lg transition-colors" %>
    </div>
  </div>
</div>

<!-- Feed Tab Switching JavaScript Controller -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize feed tabs controller
  const feedTabsController = {
    currentTab: 'for_you',

    initialize() {
      this.updateActiveTab();

      // Listen for activity feed events
      document.addEventListener('activity-feed:change-type', (event) => {
        this.currentTab = event.detail.feedType;
        this.updateActiveTab();
      });
    },

    switchTab(feedType) {
      this.currentTab = feedType;
      this.updateActiveTab();

      // Dispatch event to activity feed controller
      document.dispatchEvent(new CustomEvent('activity-feed:change-type', {
        detail: { feedType: feedType }
      }));
    },

    updateActiveTab() {
      const tabs = document.querySelectorAll('[data-feed-type]');
      tabs.forEach(tab => {
        const isActive = tab.dataset.feedType === this.currentTab;
        tab.classList.toggle('active', isActive);
      });
    },

    refreshFeed() {
      // Trigger feed refresh
      const activityFeed = document.querySelector('[data-controller="activity-feed"]');
      if (activityFeed && activityFeed._stimulusControllers) {
        const controller = activityFeed._stimulusControllers.find(c => c.identifier === 'activity-feed');
        if (controller) {
          controller.requestFeedUpdate();
        }
      }
    }
  };

  // Attach event listeners to tabs
  document.querySelectorAll('[data-feed-type]').forEach(button => {
    button.addEventListener('click', () => {
      feedTabsController.switchTab(button.dataset.feedType);
    });
  });

  // Attach refresh button
  const refreshButton = document.querySelector('[data-action*="refreshFeed"]');
  if (refreshButton) {
    refreshButton.addEventListener('click', () => {
      feedTabsController.refreshFeed();
    });
  }

  // Initialize
  feedTabsController.initialize();
});
</script>

<style>
/* Activity feed animations */
@keyframes slideInFromTop {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.activity-item-enter {
  animation: slideInFromTop 0.3s ease-out;
}

/* Loading skeleton */
.loading-skeleton {
  background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

@keyframes loading {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

/* Dark mode skeleton */
.dark .loading-skeleton {
  background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
  background-size: 200% 100%;
}
</style>